<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HK POS eSignature | 전송 완료</title>
  <link rel="icon" href="data:," />

  <link rel="stylesheet" href="assets/style.css" />

  <link rel="stylesheet" href="assets/app.css" />
</head>
<body class="app-body" data-app-page="completion" data-layout-title="전송 완료" data-layout-subtitle="5 / 5단계 • POS 처리 결과" data-layout-title-i18n="screen.completion.title" data-layout-subtitle-i18n="screen.completion.subtitle">
  <div class="app-stage">
    <div class="app-shell">
      <header class="app-topbar" data-layout="topbar"></header>

      <main class="app-page">
        <div class="app-grid">
          <section class="app-card">
            <div style="margin-top: 12px; display:flex; justify-content:center;">
              <div class="device-frame" aria-label="Tablet preview frame">
                <div class="device-frame__screen">
                  <iframe class="device-frame__iframe" src="app/06_completion.html" title="태블릿 화면 - 전송 완료"></iframe>
                  <div class="device-frame__home-indicator" aria-hidden="true"></div>
                </div>
              </div>
            </div>
          </section>

          <aside class="app-card">
            <div class="app-card-title" data-i18n="common.screenTitle"></div>
            <p class="app-hint" data-i18n="wrapper.completion.screenDesc"></p>

            <div class="app-card-title" style="margin-top: 20px; margin-bottom: 8px;" data-i18n="common.columnTitle"></div>
            <ul style="margin-left: 18px; color: var(--text-secondary); line-height: 1.7;">
              <li data-i18n="wrapper.completion.column1"></li>
              <li data-i18n="wrapper.completion.column2"></li>
              <li data-i18n="wrapper.completion.column3"></li>
              <li data-i18n="wrapper.completion.column4"></li>
              <li data-i18n="wrapper.completion.column5"></li>
            </ul>

            <div class="app-card-title" style="margin-top: 20px; margin-bottom: 8px;" data-i18n="common.usageTitle"></div>
            <ul style="margin-left: 18px; color: var(--text-secondary); line-height: 1.7;">
              <li data-i18n="wrapper.completion.usage1"></li>
              <li data-i18n="wrapper.completion.usage2"></li>
              <li data-i18n="wrapper.completion.usage3"></li>
            </ul>

            <div class="app-card-title" style="margin-top: 20px; margin-bottom: 8px;" data-i18n="common.testDataTitle"></div>
            <div style="margin-bottom: 12px;">
              <div style="font-weight: var(--font-weight-medium); color: var(--text-primary); margin-bottom: 8px;" data-i18n="wrapper.completion.testDataTitle"></div>
              <div style="display: grid; gap: 8px;">
                <button class="demo-btn-secondary" onclick="setCompletionStatus('success')" style="text-align: left; padding: 10px 12px; border: 1px solid var(--border-light); border-radius: var(--border-radius); background: white; cursor: pointer;">
                  <div style="font-weight: var(--font-weight-medium); color: var(--text-primary);" data-i18n="wrapper.completion.testSuccess"></div>
                  <div style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-top: 2px;" data-i18n="wrapper.completion.testSuccessDesc"></div>
                </button>
                <button class="demo-btn-secondary" onclick="setCompletionStatus('error', 'network')" style="text-align: left; padding: 10px 12px; border: 1px solid var(--border-light); border-radius: var(--border-radius); background: white; cursor: pointer;">
                  <div style="font-weight: var(--font-weight-medium); color: var(--text-primary);" data-i18n="wrapper.completion.testNetwork"></div>
                  <div style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-top: 2px;" data-i18n="wrapper.completion.testNetworkDesc"></div>
                </button>
                <button class="demo-btn-secondary" onclick="setCompletionStatus('error', 'validation')" style="text-align: left; padding: 10px 12px; border: 1px solid var(--border-light); border-radius: var(--border-radius); background: white; cursor: pointer;">
                  <div style="font-weight: var(--font-weight-medium); color: var(--text-primary);" data-i18n="wrapper.completion.testValidation"></div>
                  <div style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-top: 2px;" data-i18n="wrapper.completion.testValidationDesc"></div>
                </button>
                <button class="demo-btn-secondary" onclick="setCompletionStatus('error', 'server')" style="text-align: left; padding: 10px 12px; border: 1px solid var(--border-light); border-radius: var(--border-radius); background: white; cursor: pointer;">
                  <div style="font-weight: var(--font-weight-medium); color: var(--text-primary);" data-i18n="wrapper.completion.testServer"></div>
                  <div style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-top: 2px;" data-i18n="wrapper.completion.testServerDesc"></div>
                </button>
                <button class="demo-btn-secondary" onclick="setCompletionStatus('error', 'permission')" style="text-align: left; padding: 10px 12px; border: 1px solid var(--border-light); border-radius: var(--border-radius); background: white; cursor: pointer;">
                  <div style="font-weight: var(--font-weight-medium); color: var(--text-primary);" data-i18n="wrapper.completion.testPermission"></div>
                  <div style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-top: 2px;" data-i18n="wrapper.completion.testPermissionDesc"></div>
                </button>
              </div>
            </div>
            <div class="app-hint" style="margin-top: 12px;" data-i18n="wrapper.completion.testDataHint"></div>

            <div class="app-callout" style="margin-top: 20px;">
              <strong data-i18n="common.designNoteDevTitle"></strong>
              <ul style="margin-left: 18px; margin-top: 6px; line-height: 1.7;">
                <li data-i18n="wrapper.completion.designState"></li>
                <li data-i18n="wrapper.completion.designError"></li>
                <li data-i18n="wrapper.completion.designRetry"></li>
                <li data-i18n="wrapper.completion.designReset"></li>
                <li data-i18n="wrapper.completion.designApi"></li>
              </ul>
            </div>
          </aside>
        </div>
      </main>
    </div>
  </div>

  <script src="assets/config.js"></script>
  <script src="assets/utils.js"></script>
  <script src="assets/i18n.js"></script>
  <script src="assets/layout.js"></script>
  <!-- Core modules -->
  <script src="assets/form-handler.js"></script>
  <!-- Page modules -->
  <script src="assets/pages/topbar.js"></script>
  <script src="assets/pages/list.js"></script>
  <script src="assets/pages/login.js"></script>
  <script src="assets/pages/customer-search.js"></script>
  <script src="assets/pages/consultation-selection.js"></script>
  <script src="assets/pages/tabs.js"></script>
  <script src="assets/pages/review.js"></script>
  <script src="assets/pages/completion.js"></script>
  <script src="assets/pages/signature.js"></script>
  <script src="assets/pages/wrapper.js"></script>
  <!-- Main entry point -->
  <script src="assets/app.js"></script>
  <script>
    function setCompletionStatus(status, errorType) {
      // localStorage에 저장
      localStorage.setItem("hkpos.esign.completionStatus", status);
      if (errorType) {
        localStorage.setItem("hkpos.esign.errorType", errorType);
      } else {
        localStorage.removeItem("hkpos.esign.errorType");
      }
      
      // iframe에 postMessage로 상태 변경 명령 전달
      const iframe = document.querySelector(".device-frame__iframe");
      if (iframe && iframe.contentWindow) {
        // 약간의 지연을 두고 메시지 전송 (iframe이 준비될 시간 확보)
        setTimeout(function() {
          iframe.contentWindow.postMessage({
            type: "updateCompletionStatus",
            status: status,
            errorType: errorType || null
          }, "*");
        }, 100);
      }
    }
    
    // iframe 로드 완료 후 초기 상태 전달
    window.addEventListener("load", function() {
      const iframe = document.querySelector(".device-frame__iframe");
      if (iframe) {
        iframe.addEventListener("load", function() {
          // iframe이 완전히 로드된 후 메시지 전송
          setTimeout(function() {
            const status = localStorage.getItem("hkpos.esign.completionStatus") || "success";
            const errorType = localStorage.getItem("hkpos.esign.errorType") || null;
            if (iframe.contentWindow) {
              iframe.contentWindow.postMessage({
                type: "updateCompletionStatus",
                status: status,
                errorType: errorType
              }, "*");
            }
          }, 200);
        });
      }
    });
  </script>
</body>
</html>
